<mat-card>
    <mat-card-title style="font-family: 'Times New Roman', Times, serif;font-size:320%;color: #0d17a1;padding: 1%;">
        Fee Report
    </mat-card-title><br><br>
    <form [formGroup]="searchForm" (ngSubmit)="onSearchFeesNew()" style="margin-left: 54px;">
        <mat-form-field>
            <mat-label>From Date</mat-label>
            <input matInput [matDatepicker]="fromPicker" formControlName="fromDate">
            <mat-datepicker-toggle matSuffix [for]="fromPicker"></mat-datepicker-toggle>
            <mat-datepicker #fromPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field>
            <mat-label>To Date</mat-label>
            <input matInput [matDatepicker]="toPicker" formControlName="toDate">
            <mat-datepicker-toggle matSuffix [for]="toPicker"></mat-datepicker-toggle>
            <mat-datepicker #toPicker></mat-datepicker>
        </mat-form-field>

        <mat-form-field>
            <mat-label>Status</mat-label>
            <mat-select formControlName="status">
                <mat-option [value]="null">All</mat-option>
                <mat-option [value]="feeStatus.paid">Paid</mat-option>
                <mat-option [value]="feeStatus.pending">Pending</mat-option>
                <mat-option [value]="feeStatus.partiallyPaid">Partially Paid</mat-option>
            </mat-select>
        </mat-form-field>

        <mat-form-field>
  <mat-label>Branch</mat-label>

  <mat-select formControlName="branchId">
   <mat-option value="ALL">All</mat-option>

    <mat-option *ngFor="let branch of branches"
                [value]="branch.branchId">
      {{ branch.branchName }}
    </mat-option>
  </mat-select>
</mat-form-field>

   
        
        <button mat-raised-button color="primary" type="submit"
            style="margin-left: 20px;margin-bottom: 20px;">Search</button>

           
    
<button class="btn btn-success"
        style="margin-left: 450px;margin-bottom: 20px;"
        (click)="downloadExcel()">
  Download Excel
</button>

            
    </form>
 


    

    <!-- <div style="display: flex; gap: 12px; margin-top: 16px; justify-content: center;">
        <mat-card style="max-width: 250px; padding: 12px; background-color: #e3f2fd; color: #0d47a1;">
            <mat-card-title style="font-size: 16px;">Today's Collection</mat-card-title>
            <mat-card-content style="font-size: 14px; line-height: 1.8; padding: 8px 16px;">
                <div style="display: flex; justify-content: space-between; font-weight: 500;">
                    <span>Total &nbsp;</span>
                    <span>:{{ getTodayTotalCollection() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Collected &nbsp;</span>
                    <span>:{{ getTodayCollected() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Balance &nbsp;</span>
                    <span>:{{ getTodayPending() }}</span>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card style="max-width: 250px; padding: 12px; background-color: #f1f8e9; color: #33691e;">
            <mat-card-title style="font-size: 16px;">Current Month</mat-card-title>
            <mat-card-content style="font-size: 14px; line-height: 1.8; padding: 8px 16px;">
                <div style="display: flex; justify-content: space-between; font-weight: 500;">
                    <span>Total &nbsp;</span>
                    <span>:{{ getMonthTotalCollection() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Collected &nbsp;</span>
                    <span>:{{ getMonthCollected() }}</span>
                </div>
                <div style="display: flex; justify-content: space-between;">
                    <span>Balance &nbsp;</span>
                    <span>:{{ getMonthPending() }}</span>
                </div>
            </mat-card-content>
        </mat-card>

        <mat-card style="margin-top: 16px; padding: 12px; background-color: #f6e4fa;">
            <mat-card-title style="font-size: 16px;">Legend</mat-card-title>
            <mat-card-content style="display: flex; gap: 20px; flex-wrap: wrap; font-size: 14px;">
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 16px; height: 16px; background-color: #c8e6c9; border: 1px solid #81c784;"></div>
                    Paid
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 16px; height: 16px; background-color:  #ccedf5; border: 1px solid #81c784;"></div>
                    Partialy Paid
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 16px; height: 16px; background-color: #fff9c4; border: 1px solid #fdd835;"></div>
                    Current Month
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 16px; height: 16px; background-color: #ffcdd2; border: 1px solid #e57373;"></div>
                    Overdue
                </div>
                <div style="display: flex; align-items: center; gap: 6px;">
                    <div style="width: 16px; height: 16px; background-color: #fad2b0; border: 1px solid #f6c564;"></div>
                    Today
                </div>
            </mat-card-content>
        </mat-card>

    </div> -->
     
<div class="report-card">
  <h3 class="report-title">Student Fee Report</h3>

  <div class="table-wrapper mat-elevation-z8">
    <table class="modern-table">
      <thead>
        <tr>
          <th>ID</th>
          <th>Student Name</th>
          <th>Paid Amount (₹)</th>
          <th>Balance (₹)</th>
          <th>Overdue (₹)</th>
          <th>Total  (₹)</th>
          <th>Details</th>
        </tr>
      </thead>

      <tbody>
        <!-- <tr *ngFor="let student of summarizedFees; let i = index">
          <td class="id-cell" [title]="student.studentId">{{ student.studentId | slice:0:6 }}</td>

          <td class="student-name">{{ student.studentName }}</td>
          <td class="paid">{{ student.paidAmount | number: '1.0-0' }}</td>
          <td class="balance">{{ student.balance | number: '1.0-0' }}</td>
          <td [class.overdue-highlight]="student.overdue > 0">
            {{ student.overdue | number: '1.0-0' }}
          </td>
          <td>{{ student.totalDue | number: '1.0-0' }}</td>
          <td>
            <button class="btn-view" (click)="viewDetails(student)">View</button>
          </td>
        </tr> -->
      <tr *ngFor="let student of summarizedFees">
  <td>{{ student.studentReferenceId}}</td>
  <td>{{ student.studentName }}</td>
  <td>{{ student.totalPaidAmount }}</td>
 <td>{{ student.balance }}</td>
  <td>{{student.totalDueAmount}}</td>
  <td>{{ student.totalAmount }}</td>
  
    <td>
  <button class="btn btn-sm btn-outline-primary"
          (click)="viewStudent(student)">
     View
  </button>
</td>

  
</tr>


            <!-- <tr class="total-row">
    <td colspan="2"><strong>Grand Total</strong></td>

    <td class="paid">
        <strong>{{ getTotalPaid() | number:'1.0-0' }}</strong>
    </td>
    <td class="balance">
        <strong>{{ getTotalBalance() | number:'1.0-0' }}</strong>
    </td>
    <td>
        <strong>{{ getTotalOverdue() | number:'1.0-0' }}</strong>
    </td>
    <td>
        <strong>{{ getGrandTotal() | number:'1.0-0' }}</strong>
    </td>
    <td></td>
    </tr> -->
<tr class="total-row">
  <td colspan="2"><strong>Grand Total</strong></td>
  <td><strong>{{ finalReport?.totalAmountPaid }}</strong></td>
  <td><strong>{{ finalReport?.totalBalanceAmount }}</strong></td>
<td><strong>{{ finalReport?.totalDueAmount }}</strong></td>
  <td><strong>{{ finalReport?.totalFees }}</strong></td>
  <td></td>
</tr>





      </tbody>
    </table>
  </div>
</div>


    
</mat-card>